#!/bin/bash

G='\033[0;32m'; B='\033[1;34m'; P='\033[0;35m'; N='\033[0m'
found=()
tries=0

echo -e "\n${B}ðŸŒŒ Meher-Ipsâ„¢ Live Ping Hunter <110ms${N}\n"

# ðŸš€ Ø§ÙˆÙ„: Ø¨Ù¾Ø±Ø³ ØªØ¹Ø¯Ø§Ø¯ Ø±Ùˆ!
read -p "${G}Ú†Ù†Ø¯ØªØ§ IP Ø³Ø±ÛŒØ¹ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†Ù…ØŸ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: 3) ${N}" num
if [[ -z "$num" ]]; then
  num=3
fi

# ðŸŒ¿ Ø¨Ù¾Ø±Ø³ ÙØ±Ù…Øª Ø®Ø±ÙˆØ¬ÛŒ!
read -p "${G}ÙØ±Ù…Øª Ù„ÛŒØ³Øª Ø®Ø§Ù…: v (Ø¹Ù…ÙˆØ¯ÛŒ) ÛŒØ§ h (Ø§ÙÙ‚ÛŒ Ø¨Ø§ Ú©Ø§Ù…Ø§)ØŸ (Ù¾ÛŒØ´â€ŒÙØ±Ø¶: v) ${N}" format
if [[ -z "$format" ]]; then
  format="v"
fi
if [[ "$format" == "h" || "$format" == "horizontal" ]]; then
  format="h"
else
  format="v"
fi

echo -e "${P}ðŸš€ Ø¢Ù…Ø§Ø¯Ù‡ Ú©Ø§ÙˆØ´ ${num} Ø³ØªØ§Ø±Ù‡â€ŒØ§ÛŒØŸ ðŸŒŒ Ø´Ø±ÙˆØ¹...${N}\n"

while (( ${#found[@]} < num )); do
  ((tries++))

  # ðŸŽ² Choose random range between 172.67 and 162.159
  if (( RANDOM % 2 == 0 )); then
    ip="172.65.$((RANDOM % 256)).$((RANDOM % 256))"
  else
    ip="162.159.$((RANDOM % 256)).$((RANDOM % 256))"
  fi

  echo -ne "${G}MehrabanScan${N} #$tries â†’ $ip â³ "

  ping_output=$(ping -c1 -W1 $ip 3>/dev/null 2>&1)
  ms=$(echo "$ping_output" | grep 'time=' | awk -F'time=' '{print $2}' | awk '{print $1}' | cut -d'm' -f1)
  [[ -z "$ms" ]] && echo "no reply" && continue

  if (( $(echo "$ms < 105" | bc -l) )); then
    echo -e "${G}âœ… ${ms}ms${N} ${P}ðŸš€ Ú©Ø´Ù ÙØ¶Ø§ÛŒÛŒ! ðŸŒŒ${N}"
    found+=("$ip â†’ ${ms}ms")
  else
    echo "too high (${ms}ms) â€“ Ø¨Ù‡ Ú©Ø§ÙˆØ´ Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡!"
  fi
done

# ðŸ”µ Ø®Ø±ÙˆØ¬ÛŒ Ø§ØµÙ„ÛŒ - Ù‡ÛŒØ¬Ø§Ù†ÛŒ Ùˆ ØªØ±ØªÛŒØ¨ÛŒ! (Ø¨Ø§ ÙÙ„Ø´ Ùˆ ms)
echo -e "\n${B}âœ¦â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ¦${N}"
echo -e "${P}ðŸŒŒðŸš€  Ú©Ø´Ùâ€ŒÙ‡Ø§ÛŒ Ú©Ù‡Ú©Ø´Ø§Ù†ÛŒ: ${#found[@]} Ø³ØªØ§Ø±Ù‡ Ø³Ø±ÛŒØ¹ Ø²ÛŒØ± Û±Û°Ûµms! ðŸŒŒðŸš€${N}"
echo -e "${B}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ¦${N}"

for i in {0..$((num-1))}; do
  echo -e "${G}$((i+1)). ${found[i]}${N}  ${P}âœ¨ Ø¢Ù…Ø§Ø¯Ù‡ Ù¾Ø±ÙˆØ§Ø²! âœ¨${N}"
done

echo -e "${B}âœ¦â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ¦${N}"
echo -e "${G}ðŸ“¦ ØªØ£ÛŒÛŒØ¯Ø´Ø¯Ù‡ ØªÙˆØ³Ø· MehrabanScanâ„¢ â€“ Ú©Ø§ÙˆØ´ Ø¨Ø¹Ø¯ÛŒØŸ ðŸŒ¿ (ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ØªÙ„Ø§Ø´: $tries)${N}"
echo -e "${B}âœ¦â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€âœ¦${N}\n"

# ðŸ“‹ Ø¨Ø®Ø´ Ú©Ù¾ÛŒ Ø¢Ø³Ø§Ù† - ÙÙ‚Ø· IPÙ‡Ø§ÛŒ Ø®Ø§Ù„Øµ!
echo -e "\n${P}ðŸŒŒ IPÙ‡Ø§ÛŒ Ø®Ø§Ù„Øµ Ø¢Ù…Ø§Ø¯Ù‡ â€“ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ù‡ Ù¾Ù†Ù„! ðŸš€${N}"
echo -e "${B}ðŸ“‹ IPÙ‡Ø§ÛŒ Ø®Ø§Ù„Øµ Ø¨Ø±Ø§ÛŒ Ù¾Ù†Ù„ (Ú©Ù¾ÛŒ Ø³Ø±Ø¬Ù…Ø¹ÛŒ - ${format}):${N}"
echo -e "${B}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${N}"

if [[ "$format" == "v" ]]; then
  for item in "${found[@]}"; do
    clean_ip=$(echo "$item" | cut -d' ' -f1)  # ÙÙ‚Ø· IP (Ù‚Ø¨Ù„ Ø§Ø² â†’)
    echo -e "${G}${clean_ip}${N}"
  done
else
  # Ø§ÙÙ‚ÛŒ: IPÙ‡Ø§ÛŒ Ø®Ø§Ù„Øµ Ø¯Ø± ÛŒÙ‡ Ø®Ø· Ø¨Ø§ Ú©Ø§Ù…Ø§
  ips_clean=()
  for item in "${found[@]}"; do
    ips_clean+=($(echo "$item" | cut -d' ' -f1))
  done
  copy_line=$(IFS=', '; echo "${ips_clean[*]}")
  echo -e "${G}${copy_line}${N}"
fi

echo -e "${B}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${N}\n"
